@page "/"

@using RentOfWorkshopsCore.DBConnection
@using RentOfWorkshopsCore.DBContext
@using RentOfWorkshopsWEB.Shared.Space
@using RentOfWorkshopsWEB.Shared.SearhBar

@inject SpaceListFilter SpaceFilter

<SearchBarComponent OnSearchCallback="OnSearch"/>
<SpacesCollectionComponent Spaces=_spaceList/>

@code{
    private List<Space> _spaceList;

    private string _searchString;

    protected override Task OnInitializedAsync()
    {
        UpdateList();
        return base.OnInitializedAsync();
    }

    private void OnSearch(string searchString)
    {
        _searchString = searchString;
        UpdateList();
    }

    private void UpdateList()
    {
        _spaceList = SQLConnection.GetAllSpaces();

        var typeOfSpace = SQLConnection.GetAllTypesOfSpace().Where(s => s.Id == SpaceFilter.TypeOfSpaceId).FirstOrDefault();

        if (typeOfSpace != null)
            _spaceList = SQLConnection.GetAllSpaces().Where(s => s.TypeOfSpaceId == SpaceFilter.TypeOfSpaceId).ToList();

        if(!String.IsNullOrEmpty(_searchString))
            _spaceList = _spaceList.Where(p => p.House.Street.Name.ToLower().Contains(_searchString.ToLower())).ToList();
    }
}